<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Group_2"
             x:Class="Group_2.AdminPanelPage">

    <ContentPage.Resources>
        <local:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <local:SelectedEqualsItemConverter x:Key="SelectedEqualsItemConverter"/>
        <local:EmailFallbackConverter x:Key="EmailFallbackConverter"/>
        <Style TargetType="Entry">
            <Setter Property="Margin" Value="0,4"/>
        </Style>
    </ContentPage.Resources>

    <Grid>
        <StackLayout Padding="16" Spacing="12">

            <Picker x:Name="TypePicker"
                Title="Näytä"
                SelectedIndexChanged="OnTypeChanged">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Tapahtumat</x:String>
                        <x:String>Käyttäjät</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <SearchBar x:Name="SearchBar"
                   Placeholder="Hae..."
                   TextChanged="OnSearchTextChanged" />

            <Border
                BackgroundColor="LightGray"
                HeightRequest="500"
                StrokeShape="RoundRectangle 24"
                Padding="10"
                IsVisible="{Binding IsEventView}">

                <CollectionView x:Name="EventsList"
                        ItemsSource="{Binding events}"
                        SelectedItem="{Binding SelectedEvent, Mode=TwoWay}"
                        SelectionMode="Single"
                        IsVisible="{Binding IsEventView}"
                        SelectionChanged="OnEventSelectionChanged">
                    <CollectionView.ItemTemplate>

                        <DataTemplate>
                            <Border x:Name="RootBorder"
                                    Stroke="LightGray"
                                    StrokeThickness="1"
                                    Background="White"
                                    Padding="8"
                                    Margin="0,4">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8"/>
                                </Border.StrokeShape>

                                <VerticalStackLayout Spacing="2">
                                    <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="18"/>
                                    <Label Text="{Binding Description}" FontSize="14"/>
                                    <Label Text="{Binding StartDate, StringFormat='Alkaa: {0:dd.MM.yyyy}'}" FontSize="12"/>
                                    <Label Text="{Binding EndDate, StringFormat='Päättyy: {0:dd.MM.yyyy}'}" FontSize="12"/>
                                    <Label Text="{Binding ParticipantsDisplay}" FontSize="12" TextColor="Gray" Margin="0,10,0,0"/>
                                </VerticalStackLayout>

                                <Border.Triggers>
                                    <DataTrigger TargetType="Border" Value="True">
                                        <DataTrigger.Binding>
                                            <MultiBinding Converter="{StaticResource SelectedEqualsItemConverter}">
                                                <Binding Source="{x:Reference EventsList}" Path="SelectedItem"/>
                                                <Binding Path="."/>
                                            </MultiBinding>
                                        </DataTrigger.Binding>
                                        <Setter Property="Stroke" Value="#7B3AED"/>
                                        <Setter Property="StrokeThickness" Value="2"/>
                                        <Setter Property="Background" Value="#F3E8FF"/>
                                    </DataTrigger>
                                </Border.Triggers>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Border>

            <Border
                BackgroundColor="LightGray"
                HeightRequest="508"
                StrokeShape="RoundRectangle 24"
                Padding="10"
                IsVisible="{Binding IsUserView}">

                <CollectionView x:Name="UsersList"
                ItemsSource="{Binding users}"
                SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                SelectionMode="Single"
                IsVisible="{Binding IsUserView}"
                SelectionChanged="OnUserSelectionChanged">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border x:Name="UserRootBorder"
                                    Stroke="LightGray"
                                    StrokeThickness="1"
                                    Background="White"
                                    Padding="8"
                                    Margin="0,4">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8"/>
                                </Border.StrokeShape>

                                <VerticalStackLayout Spacing="2">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="16"/>
                                    <Label Text="{Binding Email, Converter={StaticResource EmailFallbackConverter}}" FontSize="12" TextColor="Gray"/>
                                </VerticalStackLayout>

                                <Border.Triggers>
                                    <DataTrigger TargetType="Border" Value="True">
                                        <DataTrigger.Binding>
                                            <MultiBinding Converter="{StaticResource SelectedEqualsItemConverter}">
                                                <Binding Source="{x:Reference UsersList}" Path="SelectedItem"/>
                                                <Binding Path="."/>
                                            </MultiBinding>
                                        </DataTrigger.Binding>
                                        <Setter Property="Stroke" Value="#7B3AED"/>
                                        <Setter Property="StrokeThickness" Value="2"/>
                                        <Setter Property="Background" Value="#F3E8FF"/>
                                    </DataTrigger>
                                </Border.Triggers>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Border>

            <Label x:Name="EmptyLabel"
               Text="Ei näytettäviä tietoja"
               IsVisible="False"
               HorizontalOptions="Center"/>

            <StackLayout Orientation="Horizontal" Spacing="8" HorizontalOptions="Center">
                <Button Text="Lisää" Clicked="OnAddClicked" IsVisible="{Binding IsEventView}">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
                <Button Text="Muokkaa" Clicked="OnEditClicked" IsEnabled="{Binding SelectedEvent, Converter={StaticResource NullToBoolConverter}}" IsVisible="{Binding IsEventView}">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
                <Button Text="Poista" Clicked="OnDeleteClicked" IsEnabled="{Binding SelectedEvent, Converter={StaticResource NullToBoolConverter}}" IsVisible="{Binding IsEventView}">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
                <Button Text="Lisää osallistujia" Clicked="OnAddParticipantsClicked" IsEnabled="{Binding SelectedEvent, Converter={StaticResource NullToBoolConverter}}" IsVisible="{Binding IsEventView}">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
                <Button Text="Muokkaa osallistujia" Clicked="OnEditParticipantsClicked" IsEnabled="{Binding SelectedEvent, Converter={StaticResource NullToBoolConverter}}" IsVisible="{Binding IsEventView}">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
            </StackLayout>

            <HorizontalStackLayout Spacing="8"
                     HorizontalOptions="Center" 
                     VerticalOptions="Start"
                     IsVisible="{Binding IsUserView}"
                     HeightRequest="50">
                <Button Text="Lisää käyttäjä" Clicked="OnAddClicked" WidthRequest="200">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
                <Button Text="Muokkaa käyttäjää" Clicked="OnEditClicked" 
                    IsEnabled="{Binding SelectedUser, Converter={StaticResource NullToBoolConverter}}"
                    WidthRequest="200">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
                <Button Text="Poista käyttäjä" Clicked="OnDeleteClicked" 
                    IsEnabled="{Binding SelectedUser, Converter={StaticResource NullToBoolConverter}}"
                    WidthRequest="200">
                    <Button.Shadow>
                        <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
                    </Button.Shadow>
                </Button>
            </HorizontalStackLayout>

        </StackLayout>
        
        <Button Text="Avaa kalenteri"
                BackgroundColor="#007ACC"
                WidthRequest="200"
                FontSize="Medium"
                VerticalOptions="End"
                HorizontalOptions="End"
                HeightRequest="50"
                Clicked="OnOpenCalendarClicked"
                Margin="0,0,30,30">

            <Button.Shadow>
                <Shadow
                        Brush="Black"
                        Offset="0,0"
                        Radius="10"
                        Opacity="0.25" />
            </Button.Shadow>

        </Button>
    </Grid>

</ContentPage>